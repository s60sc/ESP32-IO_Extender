
<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TuyaSniffer</title>
    <STYLE type="text/css">
      body {
        margin: 10px;
      }
      table {
        font-family: arial, sans-serif;
        border-collapse: collapse;
        width: 90%;
      }
      td, th {
        border: 0px solid #dddddd;
        text-align: left;
        padding: 8px;
      } 
    </STYLE>
  </head>
  <body>
    <h3>Control & Monitor</h3>
    <table id="button-group">
      <tr>
      <td><a href="/web?WSL.htm"><button>Monitor Log</button></a></td>
      <td><a href="/web?configs.txt"><button>View Config</button></a></td>
      <td><a href="/web?OTA.htm"><button>OTA Update</button></a></td>
      <td><a href="/control?reset=1"><button>Reboot ESP</button></a></td>
      <td><a href="/control?deldata=1"><button>Reload Spiffs</button></a></td>
      </tr>
    </table>
    </br>
    <form onsubmit="return sendCmd()">
      <input style="width:90%;" placeholder="Enter command for device and press return" id='txtCmd'/> 
    </form>
    <pre id='log' style="height:90%;width:90%;border:5px solid #ccc;font:16px Arial;overflow:auto;"></pre>
    <script>
      // websocket handling
      var ip = document.location.host;
      var wsServer = "ws://" + ip + ":80/ws";
      var ws = new WebSocket(wsServer);

      add_log_line("Connect to: " + wsServer);
      connect();

      // add received line to log element
      function add_log_line(text) {
        var log = document.getElementById('log');
        var new_node = document.createTextNode(text + "\n");
        log.append(new_node);
      }

      // connect to websocket server
      function connect() {
        ws.onopen = function() {
          add_log_line("Connected");
        }
        ws.onmessage = function(messageEvent) {
          add_log_line(messageEvent.data);
        }
      }
      
      // send user command to websocket server
      function sendCmd() {
        var txt  = document.getElementById('txtCmd');
        var line = txt.value;
        if (line != "") {
          ws.send(line);
          add_log_line("CMD: " + line);
          txt.value = "";
          txt.focus();
        }
        return false;
      }
    </script>
  </body>
</html>
